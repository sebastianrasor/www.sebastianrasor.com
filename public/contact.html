<!doctype html>

<!-- Copyright 2024 Sebastian Rasor <https://www.sebastianrasor.com/contact>
   -
   - This file is part of www.sebastianrasor.com
   -
   - www.sebastianrasor.com is free software: you can redistribute it and/or
   - modify it under the terms of the GNU Affero General Public License as
   - published by the Free Software Foundation, either version 3 of the
   - License, or (at your option) any later version.
   -
   - www.sebastianrasor.com is distributed in the hope that it will be useful,
   - but WITHOUT ANY WARRANTY; without even the implied warranty of
   - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero
   - General Public License for more details.
   -
   - You should have received a copy of the GNU Affero General Public License
   - along with www.sebastianrasor.com. If not, see
   - <https://www.gnu.org/licenses/>. -->

<html lang="en">
<meta charset="utf-8">
<meta name="description" content="Contact Sebastian Rasor">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="canonical" href="https://www.sebastianrasor.com/contact">
<link rel="shortcut icon" href="/favicon.svg">
<link rel="stylesheet" type="text/css" href="/stylesheet.css">
<title>Sebastian Rasor - Contact</title>
<script defer src="https://challenges.cloudflare.com/turnstile/v0/api.js"></script>
<script defer src="/openpgp.min.js"></script>
<script>
	const publicKeyArmored = [
		'-----BEGIN PGP PUBLIC KEY BLOCK-----',
		'',
		'mDMEY4K99xYJKwYBBAHaRw8BAQdA/IQHHXTVylX+N6IyS/CR2UPy4ZUlucmbjUB0',
		'cnQgivK0D1NlYmFzdGlhbiBSYXNvcoiUBBMWCgA8FiEECHjtFi+LKV8lrBl78g3k',
		'uls21OkFAmYhUuICGwMFCQPDUCEECwkIBwQVCgkIBRYCAwEAAh4FAheAAAoJEPIN',
		'5LpbNtTpVLEBAJxMQBeiyjIrpjOoFI/PK5mZrabc269mXFALV3XkBYcRAPwOvN35',
		'lkrJDEWW5gNIKhe5U8GSUUAamp8z16XlGM8YCbgzBGOCvfcWCSsGAQQB2kcPAQEH',
		'QEKty/AScQPUjYcOpf2QGawuLZZBwktjmIZ3ZiiC9VeqiH4EGBYIACYCGyAWIQQI',
		'eO0WL4spXyWsGXvyDeS6WzbU6QUCZWTaiQUJA8NQEgAKCRDyDeS6WzbU6dpXAQCQ',
		'DUahazyDPyhVbUEL0R7K5XFLk5XZBF/QvsmycVNDnAD+JLT1EoLo04Q2azxGwnuF',
		'GdnvGMH0edEHkX4rETlETQe4OARjgr33EgorBgEEAZdVAQUBAQdA7MfecvA2X0KF',
		'/7yw7wcjbBTFXVSDyuddb5yimtx1oB8DAQgHiH4EGBYIACYCGwwWIQQIeO0WL4sp',
		'XyWsGXvyDeS6WzbU6QUCZWTapQUJA8NQLgAKCRDyDeS6WzbU6VZzAQC0JGIQRtEf',
		'jW6hA07WHqxKV+mLNMRw+fo8I9b+9YIGwQD/fCTEmo4RtoPSw9TqMqHiUbhnnYuu',
		'eCTxq6gW81CT5ww=',
		'=jdl1',
		'-----END PGP PUBLIC KEY BLOCK-----'
	].join('\n');

	let blockEnableSubmit = false;
	window.enableSubmit = () => {
		if (blockEnableSubmit) return;
		const form = document.getElementById("contact-form");
		form.btnSubmit.disabled = false;
		form.btnSubmit.value = "Send Message";
		form.btnSubmit.classList.remove("button-disabled");
	}

	window.disableSubmit = () => {
		const form = document.getElementById("contact-form");
		form.btnSubmit.disabled = true;
		form.btnSubmit.value = "Please wait...";
		form.btnSubmit.classList.add("button-disabled");
	}

	const idempotencyKey = crypto.randomUUID();
	window.addEventListener("submit", async function(event) {
		event.preventDefault();
		const form = event.target;

		if (form.btnSubmit.disabled) {
			return false
		}

		disableSubmit();
		blockEnableSubmit = true;

		form.name.readOnly = true;
		form.email.readOnly = true;
		form.message.readOnly = true;
		form.name.blur();
		form.email.blur();
		form.message.blur();

		const labelForMessage = document.querySelector("label[for=message]");
		const originalInnerText = labelForMessage.innerText;
		labelForMessage.innerText = "Your message is being encrypted prior to submission."

		const publicKey = await openpgp.readKey({ armoredKey: publicKeyArmored });
		const encryptedMessage = await openpgp.encrypt({
			message: await openpgp.createMessage({ text: "Content-Type: text/plain;charset=utf-8\n\n" + form.message.value }),
			encryptionKeys: publicKey,
		})

		const unencryptedMessage = form.message.value;
		form.message.value = encryptedMessage;

		const formData = new FormData(form);
		formData.append("idempotency_key", idempotencyKey);

		const result = await fetch("/contact/submit", {
			method: "POST",
			body: formData,
		})

		const outcome = await result.json();

		if ("error" in outcome) {
			labelForMessage.innerText = outcome.error.message;
			const duration = outcome.error.message.split(/\s/g).length / (200 / 60);

			setTimeout(function() {
				form.message.value = unencryptedMessage;
				labelForMessage.innerText = originalInnerText;
				form.name.readOnly = false;
				form.email.readOnly = false;
				form.message.readOnly = false;
				blockEnableSubmit = false;
				enableSubmit();
			}, duration * 1000)

			return false;
		}

		const success = document.getElementById("success");
		form.hidden = true;
		success.hidden = false;
		turnstile.remove();

		return false;
	})
</script>
<main role="main">
    <article id="success" hidden>
        <header>
            <h1>Thanks for reaching out!</h1>
            <aside>I've received your message and I'll get back to you as soon as possible.</aside>
        </header>
        <p><a href="https://www.sebastianrasor.com">Return to www.sebastianrasor.com</a>
    </article>
	<form id="contact-form">
		<noscript>This form requires JavaScript to function.</noscript>
		<div class="horizontal-container">
			<div class="input-container">
				<input type="text" id="name" name="name" placeholder=" " required>
				<label for="name">Your Name</label>
			</div>
			<div class="input-container">
				<input type="email" id="email" name="email" placeholder=" " required>
				<label for="email">your@email.address</label>
			</div>
		</div>
		<div class="input-container">
			<textarea id="message" name="message" placeholder=" " rows="4" autocomplete="false" required></textarea>
			<label for="message">Your Message</label>
		</div>
		<input class="button button-disabled" type="submit" id="btnSubmit" name="btnSubmit" value="Please wait..." disabled>
		<div class="cf-turnstile" data-sitekey="0x4AAAAAAACsmQqydNII05ly" data-callback="enableSubmit" data-error-callback="disableSubmit" data-timeout-callback="disableSubmit" data-expired-callback="disableSubmit"></div>
	</form>
</main>
<nav role="navigation">
	<a class="button" href="/">Home</a>
	<div class="button button-disabled">Contact</div>
</nav>
<!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "0403cc8fde234719b09ccf963f4e46c9"}'></script><!-- End Cloudflare Web Analytics -->
